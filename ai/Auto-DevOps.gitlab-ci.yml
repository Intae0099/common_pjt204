# ğŸš€ AI ì• í”Œë¦¬ì¼€ì´ì…˜ Windows ë¡œì»¬ ë°°í¬

variables:
  DOCKERFILE_PATH: "docker/Dockerfile"
  PORT: "8000"
  
  # ğŸš« ë¶ˆí•„ìš”í•œ ìŠ¤ìº” ë¹„í™œì„±í™” (ì†ë„ í–¥ìƒ)
  SAST_DISABLED: "true"
  DEPENDENCY_SCANNING_DISABLED: "true" 
  CONTAINER_SCANNING_DISABLED: "true"
  DAST_DISABLED: "true"
  
  # ğŸ¯ ë°°í¬ ì „ëµ
  STAGING_ENABLED: "false"
  REVIEW_DISABLED: "true"

# ğŸ“¦ Windows ë¡œì»¬ ìë™ ë°°í¬
deploy:
  stage: deploy
  tags:
    - windows
    - docker
    - ai
  before_script:
    # í™˜ê²½ë³€ìˆ˜ íŒŒì¼ í™•ì¸ (ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¡œì»¬ .env ì‚¬ìš©)
    - if exist config\.env echo âœ… config/.env íŒŒì¼ ì¡´ì¬
    - if not exist config\.env echo âŒ config/.env íŒŒì¼ ì—†ìŒ - ìˆ˜ë™ìœ¼ë¡œ ìƒì„± í•„ìš”
    
  script:
    # 1ï¸âƒ£ Docker ìƒíƒœ í™•ì¸
    - docker --version
    - docker-compose --version
    
    # 2ï¸âƒ£ ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì •ë¦¬
    - cd docker
    - docker-compose down
    
    # 3ï¸âƒ£ ìƒˆ ë¹Œë“œ ë° ë°°í¬
    - docker-compose up -d --build
    
    # 4ï¸âƒ£ ë°°í¬ í™•ì¸ (Windowsìš© timeout)
    - timeout /t 20 /nobreak
    - curl -f http://localhost:8997/ || exit 1
    - echo âœ… ë°°í¬ ì„±ê³µ!
    
    # 5ï¸âƒ£ ìƒíƒœ í™•ì¸
    - docker-compose ps
    - docker-compose logs --tail=50 ai-app
    
  only:
    - dev-AI
    - feature/S13P11B204-488
  allow_failure: false